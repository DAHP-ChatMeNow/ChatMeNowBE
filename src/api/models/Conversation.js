const mongoose = require("mongoose");
const Schema = mongoose.Schema;

const ConversationSchema = new Schema({
  type: { type: String, enum: ["private", "group"], default: "private" },
  
  
  name: { type: String }, 
  groupAvatar: { type: String },

  members: [{
    userId: { type: Schema.Types.ObjectId, ref: "User" },
    joinedAt: { type: Date, default: Date.now },
    role: { type: String, enum: ["member", "admin"], default: "member" },
    lastReadAt: { type: Date } 
  }],

  
  lastMessage: {
    content: { type: String, default: null },
    senderId: { type: Schema.Types.ObjectId, ref: "User", default: null },
    senderName: { type: String, default: null },
    type: { type: String, default: "text" },
    createdAt: { type: Date, default: null }
  }
}, { timestamps: true });


ConversationSchema.index({ updatedAt: -1 });

module.exports = mongoose.model("Conversation", ConversationSchema);